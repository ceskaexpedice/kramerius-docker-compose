<IfModule mod_ssl.c>
	<VirtualHost *:443>
    ServerAdmin admin@kramerius-cdk.uk.tul.cz
    ServerName kramerius-cdk.uk.tul.cz
    ServerAlias kramerius-cdk.uk.tul.cz
    DocumentRoot /var/www/kramerius-cdk.uk.tul.cz
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
	
    <LocationMatch "^/search/(.*)$">
      SSLOptions +StdEnvVars
	
      <IfModule mod_proxy.c>
        ProxyPreserveHost On
		
        ProxyPass "https://127.0.0.1:8443/search/$1" retry=5
        ProxyPassReverse "https://127.0.0.18443/search/$1"
		
        <RequireAll>
          <RequireAny>
            Require expr %{SSL_CLIENT_S_DN_CN} == "ceskadigitalniknihovna.cz"
            Require expr %{SSL_CLIENT_S_DN_CN} == "czechdigitallibrary.cz"
          </RequireAny>
        </RequireAll>
      </IfModule>
    </LocationMatch>
	
    <Directory /var/www/k7.inovatika.dev>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
	
    SSLEngine On
    SSLUseStapling Off
    SSLVerifyClient require
    SSLVerifyDepth 10
	
    SSLCertificateFile /TODO_PATH/ssl/certs/kramerius-cdk.uk.tul.cz.crt
    SSLCertificateKeyFile /TODO_PATH/ssl/certs/kramerius-cdk.uk.tul.cz.key
    SSLCACertificateFile /TODO_PATH/ssl/ca/kramerius-ca.crt
    SSLProxyEngine on
	
    SSLProxyMachineCertificateFile /TODO_PATH/ssl/client/cdk-proxy.crt
	
	</VirtualHost>
	</IfModule>
